# AGENTS.md - Brew Review

Guidelines for AI coding agents working in this repository.

## Project Overview

Brew Review is a coffee e-commerce demo app for testing Retell AI voice product reviews. Built with TypeScript, React, TanStack Start (full-stack framework), and SQLite via Drizzle ORM.

## Tech Stack

- **Runtime:** Bun
- **Framework:** TanStack Start (React + Vite)
- **Database:** SQLite + Drizzle ORM
- **Styling:** Tailwind CSS v4
- **Voice AI:** Retell AI (web calls)

## Build/Lint/Test Commands

```bash
# Development
bun run dev              # Start dev server (port 3000)
bun run build            # Production build
bun run preview          # Preview production build

# Code Quality
bun run check            # Run ALL checks (typecheck + lint + format:check)
bun run typecheck        # TypeScript type checking
bun run lint             # ESLint
bun run format           # Format with Prettier
bun run format:check     # Check formatting without fixing

# Testing (Vitest)
bun run test             # Run all tests
bunx vitest run path/to/file.test.ts       # Single test file
bunx vitest run -t "test name"             # Single test by name
bunx vitest                                 # Watch mode

# Database (Drizzle)
bun run db:generate      # Generate migrations
bun run db:migrate       # Run migrations
bun run db:push          # Push schema to database
bun run db:seed          # Seed with sample data
bun run db:studio        # Open Drizzle Studio GUI
```

## Directory Structure

```
src/
├── components/       # React components
├── db/               # Database (schema.ts, index.ts, seed.ts)
├── integrations/     # Third-party integrations
├── routes/           # TanStack Router pages (file-based routing)
├── router.tsx        # Router configuration
├── routeTree.gen.ts  # AUTO-GENERATED - DO NOT EDIT
└── styles.css        # Global styles
docs/                 # Documentation
```

## Code Style

### TypeScript

- Strict mode enabled
- Use `@/*` path alias for imports from `src/`
- Prefer type inference when types are obvious
- Use explicit types for function parameters
- Use `type` imports: `import type { Product } from "@/db/schema"`
- Drizzle types: `typeof table.$inferSelect` and `typeof table.$inferInsert`
- Prefix unused parameters with underscore: `(_unused) => {}`

### Naming Conventions

| Item | Convention | Example |
|------|------------|---------|
| Files (components) | PascalCase | `Header.tsx`, `ProductCard.tsx` |
| Files (utilities) | camelCase | `schema.ts`, `seed.ts` |
| Components | PascalCase | `ProductCatalog`, `Header` |
| Functions | camelCase | `getProducts`, `startReviewCall` |
| Variables | camelCase | `coffeeProducts`, `allProducts` |
| Types/Interfaces | PascalCase | `Product`, `NewProduct` |
| DB columns | snake_case | `customer_name`, `created_at` |
| Constants | camelCase | `seedProducts` |

### React Patterns

```typescript
// File-based routes with TanStack Router
export const Route = createFileRoute("/")({
  component: MyComponent,
  loader: () => getData(),
});

// Server functions for data fetching
const getData = createServerFn({ method: "GET" }).handler(async () => {
  return db.select().from(table).all();
});

// Component props - inline typing
function ProductCard({ product }: { product: Product }) {
  // ...
}
```

### Drizzle ORM Patterns

```typescript
// Schema definition
export const tableName = sqliteTable("table_name", {
  id: integer("id", { mode: "number" }).primaryKey({ autoIncrement: true }),
  name: text("name").notNull(),
  createdAt: integer("created_at", { mode: "timestamp" }).default(sql`(unixepoch())`),
});

// Type exports
export type TableRow = typeof tableName.$inferSelect;
export type NewTableRow = typeof tableName.$inferInsert;
```

### Error Handling

- Use non-null assertion for required env vars: `process.env.DATABASE_URL!`
- Wrap async operations in try/catch when user feedback is needed
- Let errors bubble up in server functions for framework handling

### Comments

- Minimal comments; prefer self-documenting code
- Use `//` for inline explanations
- Comment types in schema: `// 'coffee' | 'equipment'`

## ESLint Rules

- `@typescript-eslint/no-unused-vars`: warn (ignores `_` prefix)
- `@typescript-eslint/no-explicit-any`: warn

## Important Files

| Purpose | Path |
|---------|------|
| Database schema | `src/db/schema.ts` |
| Route examples | `src/routes/index.tsx` |
| TypeScript config | `tsconfig.json` |
| ESLint config | `eslint.config.js` |
| Prettier config | `.prettierrc` |
| Project roadmap | `ROADMAP.md` |
| Retell AI docs | `docs/voice-ai-integration.md` |

## Critical Notes

1. **Never edit `src/routeTree.gen.ts`** - It's auto-generated by TanStack Router
2. **Environment variables** are in `.env.local` (DATABASE_URL, RETELL_API_KEY)
3. **Database file** is `dev.db` (SQLite)
4. **Run `bun run check`** before committing to catch all issues
5. **Tailwind v4** uses `@import "tailwindcss"` syntax
6. **Amber color theme** - Use amber palette for UI consistency
